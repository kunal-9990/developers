<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="robots" content="noindex" /><title>Integrate single sign-on</title>
        <link href="../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Resources/Stylesheets/Empty.css" rel="stylesheet" />
        <script src="/documentation_files/2018/webapps/29/Content/Resources//Scripts/custom.modernizr.js">
        </script>
        <script src="/documentation_files/2018/webapps/29/Content/Resources//Scripts/jquery.min.js">
        </script>
        <script src="/documentation_files/2018/webapps/29/Content/Resources//Scripts/require.min.js">
        </script>
        <script src="/documentation_files/2018/webapps/29/Content/Resources//Scripts/require.config.js">
        </script>
        <script src="/documentation_files/2018/webapps/29/Content/Resources//Scripts/foundation.min.js">
        </script>
        <script src="/documentation_files/2018/webapps/29/Content/Resources//Scripts/plugins.min.js">
        </script>
        <script src="/documentation_files/2018/webapps/29/Content/Resources//Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <h1>Integrate single sign-on</h1>
        <ul class="topiccontents">
            <li value="1"><a href="#Register" class="selected">Register a new app for single sign-on in Azure</a>
            </li>
            <li value="2"><a href="#Generate" class="selected">Generate a client secret</a>
            </li>
            <li value="3"><a href="#Generate2" class="selected">Generate a metadata endpoint</a>
            </li>
            <li value="4"><a href="#Generate3" class="selected">Generate a reply URL in Cloud</a>
            </li>
            <li value="5"><a href="#SetReply" class="selected">Set your Reply URL in Azure</a>
            </li>
            <li value="6"><a href="#TestYour" class="selected">Test your single sign-on integration</a>
            </li>
            <li value="7"><a href="#FAQ" class="selected">Frequently Asked Questions</a>
                <ul>
                    <li value="1"><a href="#Why" class="selected">Why am I receiving an error message?</a>
                    </li>
                </ul>
            </li>
        </ul>
        <p>Cloud supports single sign-on (SSO) with Azure Active Directory (Azure AD). Using SSO with Cloud reduces the number of passwords staff members are required to memorize and helps administrators manage account issues (such as password resets) from a single location.
</p>
        <h2><a name="Register"></a>Register a new app for single sign-on in Azure</h2>
        <p>To integrate Cloud with Azure AD, you must register Cloud as a new app. When registered, you can allow Cloud to access your Active Directory domain.</p>
        <p><b>To register a new app for single sign-on in Azure:</b>
        </p>
        <ol>
            <li value="1">
                <p>Sign in to your Azure portal. If you have access to more than one portal, select your account in the top-right corner, then select your desired tenant.</p>
            </li>
            <li value="2">
                <p>From the left-hand navigation pane, select <b>Azure Active Directory | App registrations | New application registration</b>.</p>
                <p>
                    <img src="/documentation_files/2018/webapps/29/Content/Resources//Images/firm-settings-sso-azure-new-app.png" alt="Registering a new app in Azure Active Directory" />
                </p>
            </li>
            <li value="3">
                <p>On the Create pane, enter your registration data:</p>
                <ul>
                    <li value="1">
                        <p><b>Name</b>: Enter an appropriate name.</p>
                    </li>
                    <li value="2">
                        <p><b>Application type</b>: Choose Web app / API.</p>
                    </li>
                    <li value="3">
                        <p><b>Sign-on URL</b>: Enter your organization’s URL. This URL is a placeholder and will be replaced with your Reply URL as part of configuring your app for single sign-on.</p>
                    </li>
                </ul>
            </li>
            <li value="4">
                <p>After you enter your information, select Create. Your application details are displayed. Save a copy of your Application ID; you’ll need it when you set your single sign-on endpoint in Cloud.</p>
            </li>
        </ol>
        <p>Your new app is registered.</p>
        <h2><a name="Generate"></a>Generate a client secret</h2>
        <p>To enable secure communication with your Active Directory domain, you need to generate a client secret. A client secret ensures the data exchanged between Cloud and Azure is encrypted. In Azure, the client secret is referred to as a <b>Key</b>.</p>
        <p><b>To generate a client secret:</b>
        </p>
        <ol>
            <li value="1">
                <p>Sign in to your Azure portal. From the left-hand navigation pane, select <b>Azure Active Directory | App registrations</b>.</p>
            </li>
            <li value="2">
                <p>Select your app, then select <b>Settings | Keys</b>.</p>
                <p>
                    <img src="/documentation_files/2018/webapps/29/Content/Resources//Images/firm-settings-sso-azure-app-settings-keys.png" alt="The Keys button in the Settings pane." />
                </p>
            </li>
            <li value="3">
                <p>Enter an appropriate <b>Key description</b> and select a <b>Duration</b>. When your key expires, users will be unable to access Cloud. We recommend selecting <b>Never Expires</b> to prevent unexpected loss of access. Select <b>Save</b>.</p>
                <p class="warning"><b>Warning</b>: Your key will be permanently hidden when you navigate away from the Keys pane. You must have access to your key to complete the SSO setup process. If you lose access to your key value, you must delete your key and generate a new one.</p>
            </li>
            <li value="4">
                <p>Your key value is displayed. Save a copy of your key value; you’ll need it when you set your single sign-on endpoint in Cloud.</p>
                <p>
                    <img src="/documentation_files/2018/webapps/29/Content/Resources//Images/firm-settings-sso-azure-app-settings-key-value.png" alt="A key with its key value displayed." />
                </p>
            </li>
        </ol>
        <p>Your key is ready to use. Remember to keep a copy of your key value; you’ll need it to complete the SSO integration process.</p>
        <h2><a name="Generate2"></a>Generate a metadata endpoint</h2>
        <p>In order to complete the SSO integration process, you need to generate a metadata endpoint. A metadata endpoint provides authorization URLs and other metadata necessary for SSO to function.</p>
        <p><b>To generate a metadata endpoint:</b>
        </p>
        <ol>
            <li value="1">
                <p>From the left-hand navigation pane, select <b>Azure Active Directory | Properties</b>.</p>
            </li>
            <li value="2">
                <p>Copy your Directory ID.</p>
                <p>
                    <img src="/documentation_files/2018/webapps/29/Content/Resources//Images/firm-settings-sso-azure-user-settings-directory-ID.png" alt="The Copy button on the Properties pane." />
                </p>
            </li>
            <li value="3">
                <p>Use your Directory ID to construct a URL in the following format:</p>
                <p>https://login.microsoftonline.com/<b>Directory ID</b>/.well-known/openid-configuration</p>
                <p>This URL is your identity provider metadata endpoint. Save a copy of it; you’ll need it when you set your single sign-on endpoint in Cloud.</p>
            </li>
        </ol>
        <p>Your metadata endpoint is ready to use.</p>
        <h2><a name="Generate3"></a>Generate a reply URL in Cloud</h2>
        <p>Using Cloud, you can generate a Reply URL for use with Azure. Azure uses your Reply URL to authenticate users when they sign in.</p>
        <p><b>To generate a reply URL&#160;in Cloud:
</b>
        </p>
        <ol>
            <li value="1">
                <p>Ensure you have the <i>Admin</i> role.</p>
            </li>
            <li value="2">
                <p>Sign in to CaseWare Cloud. From the <b>Cloud</b> menu, select <b>Firm Settings | Single Sign-On | Identity Provider</b>.</p>
            </li>
            <li value="3">
                <p>On the Identity Provider page, complete the following fields:</p>
                <ul>
                    <li value="1">
                        <p><b>Identity provider display name</b>: Enter a meaningful name for you identity provider. For example, Azure. This name will be displayed next to your Reply URL to identify it.</p>
                    </li>
                    <li value="2">
                        <p><b>Identity provider metadata endpoint</b>: Enter your metadata endpoint. To learn more, see <a href="#Generate2" class="MCXref xref selected">Generate a metadata endpoint</a>.</p>
                    </li>
                    <li value="3">
                        <p><b>Client ID</b>: Enter your Application ID. To learn more about generating an Application ID, see <a href="#Register" class="MCXref xref selected">Register a new app for single sign-on in Azure</a>.</p>
                    </li>
                    <li value="4">
                        <p><b>Client secret</b>: Enter your client secret. To learn more, <a href="#Generate2" class="MCXref xref selected">Generate a metadata endpoint</a>.</p>
                    </li>
                </ul>
                <p>
                    <img src="/documentation_files/2018/webapps/29/Content/Resources//Images/firm-settings-sso-identity-provider.png" alt="The Single Sign-On page in Settings." />
                </p>
            </li>
            <li value="4">
                <p>Select <b>Add</b>. Your reply URL is displayed. Save a copy of the reply URL; you’ll need to add it to your app in Azure AD.</p>
                <p>
                    <img src="/documentation_files/2018/webapps/29/Content/Resources//Images/firm-settings-sso-azure-reply-url.png" alt="A reply URL displayed on the Single Sign-On page." />
                </p>
            </li>
        </ol>
        <p>Your reply URL is ready to use.</p>
        <h2 id="SetReply">Set your Reply URL in Azure</h2>
        <p>After you generate a reply URL, you’ll need to add it to Azure to ensure that users can sign in successfully.</p>
        <p><b>To set your reply URL in Azure:</b>
        </p>
        <ol>
            <li value="1">
                <p>Select <b>Azure Active Directory | App Registration</b>, then select your app.</p>
                <p>
                    <img src="/documentation_files/2018/webapps/29/Content/Resources//Images/firm-settings-sso-azure-select-app.png" alt="An app displayed on the App registrations pane." />
                </p>
            </li>
            <li value="2">
                <p>Select <b>Settings | Reply URLs</b>.</p>
                <p>
                    <img src="/documentation_files/2018/webapps/29/Content/Resources//Images/firm-settings-sso-azure-app-set-reply-url.png" alt="The Reply URLs button displayed on the Settings pane." />
                </p>
            </li>
            <li value="3">
                <p>Clear the Reply URL field, then enter your reply URL. To learn more, see <a href="#Generate3" class="MCXref xref selected">Generate a reply URL in Cloud</a>.</p>
            </li>
            <li value="4">
                <p>Select <b>Save</b>.</p>
            </li>
        </ol>
        <p>Your reply URL is set.</p>
        <h2 id="TestYour">Test your single sign-on integration</h2>
        <p>Now that Cloud is integrated with your Active Directory domain, you can test the integration by selecting <b>Go to Single Sign-On</b> from your Cloud sign-in page and completing the sign-in process. If it fails, see <a href="#Why" class="MCXref xref selected">Why am I receiving an error message?</a> for more information.</p>
        <h2 id="FAQ">Frequently Asked Questions</h2>
        <p>This section contains frequently asked questions about integrating single sign-on with Cloud.</p>
        <hr width="100%" size="0" align="center" />
        <p><b>Can staff members still sign in using Cloud credentials after SSO is enabled?</b>
        </p>
        <p>After you enable SSO, staff members should only sign in using their Azure AD credentials.</p>
        <hr width="100%" size="0" align="center" />
        <p><b>After removing my identity provider and re-adding it, some users are unable to sign in. Why?</b>
        </p>
        <p>If you have removed your identity provider and re-added it, users authenticated before the removal will be unable to sign in. For those users to sign in again, create new credentials for them in Azure AD. This process will not be required in future releases.</p>
        <hr width="100%" size="0" align="center" />
        <p><b>What happens if I add a staff member’s account to Cloud before I add it to Azure AD?</b>
        </p>
        <p>If you have added a staff account to Cloud but not Azure AD, that user will not be able to sign in using SSO. To allow a staff member to sign in with SSO, add a new user to Azure AD using the email address associated with that staff member’s Cloud account as the user name. For example, to allow a staff member with the email address john.smith@peakstreak.com to sign in using SSO,  add a user to Azure AD with john.smith@peakstreak.com in the User name field.</p>
        <hr width="100%" size="0" align="center" />
        <p><b>A staff member whose account status is Inactive is still able to sign in to Cloud. Why?</b>&#160;</p>
        <p>After enabling single sign-on, account access is managed through Azure AD. To prevent a user from accessing Cloud, you must delete their account. To learn more, see <a href="https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/add-users-azure-active-directory">How to: Add or delete users using Azure Active Directory</a>. </p>
        <hr width="100%" size="0" align="center" />
        <p><b>Why can't I&#160;edit account names, email addresses or passwords in Cloud?</b>&#160;</p>
        <p>After enabling single sign-on, account names, email addresses and passwords are managed through Azure AD. To learn more, see <a href="https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/active-directory-users-profile-azure-portal">How to: Add or update a user's profile information using Azure Active Directory</a>.</p>
        <hr width="100%" size="0" align="center" />
        <h3><a name="Why"></a>Why am I receiving an error message?</h3>
        <p>If Cloud or Azure AD is misconfigured, you may see one of the error messages listed below when you attempt to sign in.</p>
        <hr width="100%" size="0" align="center" />
        <p><b>We're sorry ... Unexpected error when authenticating with identity provider
</b>
        </p>
        <p>When configuring your identity provider, you may have entered an incorrect client secret or client ID. </p>
        <ol>
            <li value="1">
                <p>Log into Cloud using your Cloud credentials.</p>
            </li>
            <li value="2">
                <p>From the Cloud menu, select <b>Firm | Single Sign-On | Identity Provider</b>.</p>
            </li>
            <li value="3">
                <p>Select the Delete icon(<img src="/documentation_files/2018/webapps/29/Content/Resources//Icons/Delete-16x16.png" style="vertical-align: text-bottom;" />) to remove your identity provider.</p>
            </li>
            <li value="4">
                <p>Add your identity provider again, and confirm that you added the correct client secret.</p>
            </li>
        </ol>
        <hr width="100%" size="0" align="center" />
        <p><b>AADSTS70001: Application with identifier ...  was not found in the directory ...</b>
        </p>
        <p>
When configuring Azure AD, you may entered an incorrect identity provider. </p>
        <ol>
            <li value="1">
                <p>Log into Cloud using your Cloud credentials.</p>
            </li>
            <li value="2">
                <p>From the Cloud menu, select <b>Firm | Single Sign-On | Identity Provider</b>.</p>
            </li>
            <li value="3">
                <p>Select the  Delete icon(<img src="/documentation_files/2018/webapps/29/Content/Resources//Icons/Delete-16x16.png" style="vertical-align: text-bottom;" />) your identity provider.</p>
            </li>
            <li value="4">
                <p>Add your identity provider again, and confirm that you added the correct client ID.</p>
            </li>
        </ol>
        <hr width="100%" size="0" align="center" />
        <p><b>AADSTS50011: The reply url specified in the request does not match the reply urls configured for the application ...</b>
        </p>
        <p>You may have entered an incorrect reply URL in Azure. </p>
        <ol>
            <li value="1">
                <p>From the left-hand navigation pane in Azure, select <b>Azure Active Directory | App Registration.</b></p>
            </li>
            <li value="2">
                <p>Select your app, then select <b>Settings | Reply URLs</b>.</p>
            </li>
            <li value="3">
                <p>Select the Context menu button next to your reply URL, then select <b>Delete</b>.</p>
            </li>
            <li value="4">
                <p>Add your reply URL again, then select <b>Save</b>.</p>
            </li>
        </ol>
        <hr width="100%" size="0" align="center" />
        <p><b>No available Cloud access licenses. To obtain additional licenses, contact your administrator.</b> <![CDATA[ ]]></p>
        <p>
The number of users in your Active Directory domain exceeds the number of available Cloud licenses. When the number of users in your Active Directory domain exceeds the number of available licenses, some staff will be unable to sign in. To permit all staff members to sign in, purchase a license from MyCaseWare for each staff member or contact your local distributor.</p>
        <hr width="100%" size="0" align="center" />
        <p><b>Account already exists. User with email ... already exists. How do you want to continue?</b>
        </p>
        <p>This error occurs after a user is removed from Azure and another user is added using the same email address. <br /></p>
        <p>To work around this issue, delete the Cloud account associated with the email address displayed in the error message and have the user sign in again using SSO. <br /></p>
        <p>This process will not be required in future releases.</p>
        <hr width="100%" size="0" align="center" />
    </body>
</html>